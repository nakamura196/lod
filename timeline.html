<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <title>Application Sample</title>

</head>

<body>

  <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
    <h5 class="my-0 mr-md-auto font-weight-normal"><a href="index.html">Application Sample</a></h5>
  </div>

  <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
    <h1 class="display-4">Timeline</h1>
  </div>

  <div class="container">

    <div id="container2"></div>

    <footer class="pt-4 my-md-5 pt-md-5 border-top">
      <div class="row">
        <div class="col-12 col-md">
          <small class="d-block mb-3 text-muted">&copy; 2018 UTokyo Academic Archives Project Development Office.</small>
        </div>
      </div>
    </footer>
  </div>


  <script
  src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


  <script src="https://code.highcharts.com/highcharts.js"></script>

  <script>

  jQuery(document).ready(function() {

    jQuery.ajaxSetup({
      cache : false
    });

    showNodes()

  });


  function showNodes() {

    var query = " PREFIX dcterms: <http://purl.org/dc/terms/> ";
    query += " PREFIX o: <http://omeka.org/s/vocabs/o#> ";
    query += " select distinct * ";
    query += " where { ";

    query += " ?s dcterms:title ?title . ";
    query += " ?s o:created ?created . ";

    query += " } order by ?created ";

    $.ajax({
      type : "POST",
      url : "https://dydra.com/ut-archives-repo/lod/sparql",
      data : {
        query : query,
        format : "json"
      },
      success : function(data) {

        var result = data.results.bindings;

        var result2 = new Object();



        for(var i = 0; i < result.length; i++){
          var obj = result[i];
          var date = obj.created.value.split("T")[0];

          if(!result2[date]){
            result2[date] = 0;
          }

          result2[date] = result2[date] + 1;
        }

        var items = new Array();

        var total = 0;

        for(var key in result2){
          var item = new Array();
          item.push(Date.parse(key));
          total = total + result2[key];
          item.push(total)
          items.push(item)
        }

        // Build the chart
        Highcharts.chart('container2', {
          chart: {
            zoomType: 'x'
          },
          title: {
            text: ''
          },
          subtitle: {
            text: document.ontouchstart === undefined ?
            'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
          },
          xAxis: {
            type: 'datetime'
          },
          yAxis: {
            title: {
              text: ""//'No. of data'
            }
          },
          legend: {
            enabled: false
          },
          plotOptions: {

            series: {
              point: {

              }
            },
            area: {
              fillColor: {
                linearGradient: {
                  x1: 0,
                  y1: 0,
                  x2: 0,
                  y2: 1
                },
                stops: [
                  [0, Highcharts.getOptions().colors[0]],
                  [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                ]
              },
              marker: {
                radius: 2
              },
              lineWidth: 1,
              states: {
                hover: {
                  lineWidth: 1
                }
              },
            }
          },

          series: [{
            type: 'area',
            name: 'items',
            data: items
          }]
        });



      },
      error : function(data) {
        alert(data.statusText);
      }
    });
  }
</script>
</body>
</html>
