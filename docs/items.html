
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
        <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/
1.10.15/css/jquery.dataTables.min.css"/>

    <title>Title</title>

  </head>

  <body>

    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
      <h5 class="my-0 mr-md-auto font-weight-normal">Application Sample</h5>

    </div>

    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
      <h1 class="display-4">Items</h1>
      <p class="lead">Total: <span id="total"></span></p>
    </div>

<div class="container">



<div id="container2"></div>

<br/>

<table class="table table-striped table-hover" id="table">
	<thead id="thead">
		<tr>
			<th></th>
			<th>Collection</th>
			<th>No. of data</th>
		</tr>
	</thead>
	<tbody id="resourceListBody">
	</tbody>
</table>

      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-12 col-md">
            <small class="d-block mb-3 text-muted">&copy; 2018 UTokyo Academic Archives Project Development Office.</small>
          </div>
          </div>
      </footer>
    </div>


    <script
  src="//code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdn.datatables.net/1.10.15/j
s/jquery.dataTables.min.js"></script>


<script src="//code.highcharts.com/highcharts.js"></script>

<script>

jQuery(document).ready(function() {

  jQuery.ajaxSetup({
    cache : false
  });

	showNodes()

});


function showNodes() {

  var query = " PREFIX dcterms: <http://purl.org/dc/terms/> ";

  query += " SELECT distinct ?pub count(?pub) AS ?c ";
  query += " where { ";

  query += " ?s dcterms:title ?title . ";
  query += " ?s dcterms:relation ?relation . ";
  query += " ?s dcterms:publisher ?pub . ";
  query += " } "

var total = 0;

  $.ajax({
    type : "POST",
    url : "//arctest08.dl.itc.u-tokyo.ac.jp/sparql",
    data : {
      query : query,
      format : "json"
    },
    success : function(data) {

      var result = data.results.bindings;

      var tmp = new Array();

      var tbody = $("#resourceListBody");

    	for (var i = 0; i < result.length; i++) {
    		var obj = result[i];

        var pub = obj.pub.value;
        var c = Number(obj.c.value);

				var item = new Object();
				item.name = pub;
				item.y = c;
				tmp.push(item)
total += item.y;

        var tr = $("<tr>");
    		tbody.append(tr);

    		var td = $("<td>");
    		tr.append(td);

        td = $("<td>");
    		tr.append(td);
        td.append(pub);

        td = $("<td>");
    		tr.append(td);
        td.append(c);
    	}

$("#total").text(total);

      if(tmp.length > 1){

				// Build the chart
				Highcharts.chart('container2', {
				    chart: {
				        plotBackgroundColor: null,
				        plotBorderWidth: null,
				        plotShadow: false,
				        type: 'pie'
				    },
				    title: {
				        text: ''
				    },
				    tooltip: {
				        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
				    },
				    plotOptions: {
				        pie: {
				            allowPointSelect: true,
				            cursor: 'pointer',
				            dataLabels: {
				                enabled: false
				            },
				            showInLegend: true
				        }
				    },
				    series: [{
				        name: '',
				        colorByPoint: true,
				        data: tmp
				    }]
				});

      }

      // DataTable
    	var table = $('#table').DataTable({
    		"iDisplayLength" : 25,
    		"order" : [ [ 2, "desc" ] ]
    	});

    	table.on('order.dt search.dt', function() {
    		table.column(0, {
    			search : 'applied',
    			order : 'applied'
    		}).nodes().each(function(cell, i) {
    			cell.innerHTML = i + 1;
    		});
    	}).draw();

    },
    error : function(data) {
      alert(data.statusText);
    }
  });
}
</script>
  </body>
</html>
